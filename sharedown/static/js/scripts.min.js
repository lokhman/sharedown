/*!
 * Sharedown
 *
 * @author  Alexander Lokhman
 * @email   alex.lokhman@gmail.com
 * @link    https://github.com/lokhman/sharedown
 */
(function(b,a,c){b.Sharedown=new function(){var d=this;if("Sharedown" in b){return b.Sharedown}var f=c(a),e=c(".loader");this.load=function(){d._ajax_setup();d._form_setup();d._warnings();d._tooltips()};this._ajax_setup=function(){f.ajaxStart(d.ajax_start).ajaxStop(d.ajax_stop).ajaxError(function(){d.modal("Internal Error","Failed to load contents from the server.")})};this.ajax_start=function(){e.show()};this.ajax_stop=function(){e.hide()};this._form_setup=function(){c("form, form :input:not([autocomplete])").attr("autocomplete","off");c("form [maxlength]:not(.js-x-length)").each(function(){var h=c(this),g=h.attr("maxlength"),i=c("<small />",{"class":"help-block bg-warning",text:"Maximum "+g+" characters"}).appendTo(h.closest(".form-group"));h.on("keyup",function(){i.text(g-this.value.length+" characters left")})}).addClass("js-x-length");c("form:not(.js-dynamic)").on("submit",function(){c(":submit",this).prop("disabled",true)});c("form.js-dynamic").each(function(){d.form_dynamic(this)})};this._tooltips=function(h,g){c(g||"[title]",h).tooltip({container:"body"})};this.modal=function(j,g,i,h){c("#modal").find(".modal-title").html(j).end().find(".modal-body").html(g).end().find(".btn:last").removeClass().addClass("btn btn-"+(h||"danger")).off().one("click",function(){c("#modal").modal("hide");switch(typeof i){case"function":i();break;case"string":b.location.href=i}}).end().modal();return false};this._warnings=function(){f.on("click","[data-warning]",function(){return d.modal("Warning",c(this).data("warning"),this.href)})};this.download=function(g){if(!g){return}setTimeout(function(){b.location=g},1000)};this.form_dynamic=function(i,j,h){var g=c(i);if(!h){c.getJSON(i.action).done(function(k){c.each(k,function(l,m){var n=c('[name="'+l+'"]',i);switch(n.prop("type")){case"radio":n=n.filter('[value="'+m+'"]');case"checkbox":n.prop("checked",true).closest("label").addClass("active");break;default:n.val(m)}})})}g.off().on("submit",function(){c.ajax({url:i.action,method:g.attr("method"),data:g.serialize()}).done(function(){d.modal("Success",g.data("message"),j,"success")});return false})};c(this.load)}})(window,document,jQuery);