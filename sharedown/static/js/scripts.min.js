/*!
 * Sharedown
 *
 * @author  Alexander Lokhman
 * @email   alex.lokhman@gmail.com
 * @link    https://github.com/lokhman/sharedown
 */
(function(b,a,c){b.Sharedown=new function(){var d=this;if("Sharedown" in b){return b.Sharedown}var f=c(a),e=c(".loader");this.load=function(){d._ajax_setup();d._form_setup();d._warnings();d._tooltips();if(d.get_login()){d._timeout()}};this._ajax_setup=function(){var g="Failed to load contents from the server.";f.ajaxStart(d.ajax_start).ajaxStop(d.ajax_stop).ajaxError(function(h,i){switch(i.status){case 400:case 404:g="Parameters sent to the server are incorrect.";break;case 409:g="Submitted parameters are conflicting with the existing data.";break;case 503:g="Service is currently unavailable. Try again later."}d.modal(i.statusText,g)})};this.ajax_start=function(){e.show()};this.ajax_stop=function(){e.hide()};this._form_setup=function(){c("form, form :input:not([autocomplete])").attr("autocomplete","off");c("form [maxlength]").each(function(){var h=c(this),g=h.attr("maxlength"),i=c("<small />",{"class":"help-block bg-warning",text:"Maximum "+g+" characters"}).appendTo(h.closest(".form-group"));h.on("keyup",function(){i.text(g-this.value.length+" characters left")})});c("form:not(.js-dynamic)").on("submit",function(){c(":submit",this).prop("disabled",true)});c("form.js-dynamic").each(function(){d.form_dynamic(this,undefined,c(this).data("submit-only"))})};this._tooltips=function(){c("[title]").tooltip({container:"body"})};this.get_login=function(){return c("[data-login]").data("login")};this.modal=function(j,g,i,h){c("#modal").find(".modal-title").html(j).end().find(".modal-body").html(g).end().find(".btn:last").removeClass().addClass("btn btn-"+(h||"danger")).off().one("click",function(){c("#modal").modal("hide");switch(typeof i){case"function":i();break;case"string":b.location.href=i}}).end().modal();return false};this._warnings=function(){f.on("click","[data-warning]",function(){return d.modal("Warning",c(this).data("warning"),this.href)})};this.download=function(g,h){if(!g){return}setTimeout(function(){b.location=g},(h||1)*1000)};this.form_dynamic=function(i,j,h){var g=c(i);if(!h){c.getJSON(i.action).done(function(k){c.each(k,function(l,m){if(typeof m==="boolean"){m=+m}c('[name="'+l+'"]',i).each(function(){var n=c(this);if(n.data("mapped")===false){return}switch(n.prop("type")){case"radio":n=n.filter('[value="'+m+'"]');n.closest("label").addClass("active").siblings(".active").removeClass("active");n.prop("checked",true);break;case"checkbox":n.filter('[value="'+m+'"]').prop("checked",true);break;default:n.val(m)}})})})}g.off().on("submit",function(){c.ajax({url:i.action,method:g.attr("method"),data:g.serialize()}).done(function(){var k=c(".modal:visible");if(k.length>0){k.modal("hide")}d.modal("Success",g.data("message"),j,"success")});return false})};this._timeout=function(){setTimeout(function(){c.ajax({method:"GET",url:"/api/auth",global:false}).done(function(){d._timeout()}).fail(function(){b.location.reload()})},300*1000)};f.on({dragover:function(){return false},drop:function(g){if(g.originalEvent.dataTransfer.files.length===0){return false}if(confirm("Please drop your files only in the Storage section.\nDo you want to be redirected there?")){b.location.assign("/")}return false}});c(this.load)}})(window,document,jQuery);